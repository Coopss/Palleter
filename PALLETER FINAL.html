<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palleter</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .logo {
            font-size: 2.8rem;
            font-weight: 800;
            letter-spacing: -1px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 2.5rem;
        }

        .tagline {
            color: #dbeafe;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            min-height: 800px;
        }

        .main-content {
            padding: 30px;
        }

        .sidebar {
            background: var(--light);
            border-left: 1px solid var(--gray);
            padding: 30px;
            overflow-y: auto;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: 1px solid var(--gray);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--gray);
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .generator-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .generator-card {
            border: 2px solid var(--gray);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .generator-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .generator-card.selected {
            border-color: var(--primary);
            background: #eff6ff;
        }

        .generator-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .generator-watts {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .generator-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
        }

        .generator-specs {
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--secondary);
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .pallet-options {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .pallet-option {
            flex: 1;
            min-width: 120px;
        }

        .pallet-option input {
            display: none;
        }

        .pallet-option label {
            display: block;
            text-align: center;
            padding: 15px;
            background: var(--light);
            border: 2px solid var(--gray);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pallet-option input:checked + label {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .orders-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .order-item {
            background: white;
            border: 1px solid var(--gray);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .order-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .order-company {
            font-weight: 600;
            color: var(--dark);
            font-size: 1.1rem;
        }

        .order-date {
            color: var(--secondary);
            font-size: 0.9rem;
        }

        .order-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .order-detail-item span:first-child {
            color: var(--secondary);
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--gray);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--secondary);
            font-size: 0.9rem;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid var(--gray);
            margin-bottom: 25px;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            font-weight: 600;
            color: var(--secondary);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--dark);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--secondary);
        }

        .invoice-preview {
            background: white;
            border: 2px solid var(--gray);
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            font-family: monospace;
        }

        .invoice-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--gray);
            padding-bottom: 20px;
        }

        .invoice-details {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .invoice-items {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
        }

        .invoice-items th {
            background: var(--light);
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .invoice-items td {
            padding: 15px;
            border-bottom: 1px solid var(--gray);
        }

        .invoice-total {
            text-align: right;
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 20px;
        }

        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                border-left: none;
                border-top: 1px solid var(--gray);
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .generator-selector {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .pallet-options {
                flex-direction: column;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-pallet logo-icon"></i>
                Palleter
            </div>
            <p class="tagline">Professional Generator Order Management And Palletisation System</p>
        </header>
        
        <div class="app-container">
            <div class="main-content">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('new-order')">
                        <i class="fas fa-plus-circle"></i> New Order
                    </div>
                    <div class="tab" onclick="switchTab('orders')">
                        <i class="fas fa-list"></i> Orders
                    </div>
                    <div class="tab" onclick="switchTab('generators')">
                        <i class="fas fa-generator"></i> Generator Models
                    </div>
                    <div class="tab" onclick="switchTab('reports')">
                        <i class="fas fa-chart-bar"></i> Reports
                    </div>
                </div>
                
                <!-- new order tab. -->
                <div id="new-order" class="tab-content active">
                    <div class="card">
                        <h2 class="card-title">
                            <i class="fas fa-file-invoice"></i> Company Information
                        </h2>
                        
                        <div id="alert-area"></div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="company-name">Company Name *</label>
                                <input type="text" id="company-name" placeholder="Enter company name">
                            </div>
                            <div class="form-group">
                                <label for="contact-person">Contact Person *</label>
                                <input type="text" id="contact-person" placeholder="Enter contact person name">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email">Email Address *</label>
                                <input type="email" id="email" placeholder="Enter email address">
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number *</label>
                                <input type="tel" id="phone" placeholder="Enter phone number">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="address">Shipping Address *</label>
                            <textarea id="address" rows="3" placeholder="Enter complete shipping address"></textarea>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2 class="card-title">
                            <i class="fas fa-cogs"></i> Select Generator Model
                        </h2>
                        
                        <div class="generator-selector" id="generator-selector">
                            <!-- generator cards will be populated by javascript. -->
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="serial-number">Serial Number *</label>
                                <input type="text" id="serial-number" placeholder="Enter generator serial number">
                            </div>
                            <div class="form-group">
                                <label for="quantity">Quantity *</label>
                                <input type="number" id="quantity" value="1" min="1" max="10">
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2 class="card-title">
                            <i class="fas fa-box"></i> Pallet & Dimensions
                        </h2>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="length">Length (cm) *</label>
                                <input type="number" id="length" placeholder="Enter length">
                            </div>
                            <div class="form-group">
                                <label for="width">Width (cm) *</label>
                                <input type="number" id="width" placeholder="Enter width">
                            </div>
                            <div class="form-group">
                                <label for="height">Height (cm) *</label>
                                <input type="number" id="height" placeholder="Enter height">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Pallet Size *</label>
                            <div class="pallet-options">
                                <div class="pallet-option">
                                    <input type="radio" name="pallet" id="pallet-standard" value="standard" checked>
                                    <label for="pallet-standard">
                                        <i class="fas fa-box"></i><br>
                                        Standard<br>
                                        (120×80 cm)
                                    </label>
                                </div>
                                <div class="pallet-option">
                                    <input type="radio" name="pallet" id="pallet-euro" value="euro">
                                    <label for="pallet-euro">
                                        <i class="fas fa-box"></i><br>
                                        Euro Pallet<br>
                                        (120×100 cm)
                                    </label>
                                </div>
                                <div class="pallet-option">
                                    <input type="radio" name="pallet" id="pallet-industrial" value="industrial">
                                    <label for="pallet-industrial">
                                        <i class="fas fa-box"></i><br>
                                        Industrial<br>
                                        (120×120 cm)
                                    </label>
                                </div>
                                <div class="pallet-option">
                                    <input type="radio" name="pallet" id="pallet-custom" value="custom">
                                    <label for="pallet-custom">
                                        <i class="fas fa-edit"></i><br>
                                        Custom Size
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group" id="custom-pallet-size" style="display: none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="custom-length">Custom Length (cm)</label>
                                    <input type="number" id="custom-length" placeholder="Enter custom length">
                                </div>
                                <div class="form-group">
                                    <label for="custom-width">Custom Width (cm)</label>
                                    <input type="number" id="custom-width" placeholder="Enter custom width">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">Additional Notes</label>
                        <textarea id="notes" rows="3" placeholder="Any special instructions or notes..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="createOrder()">
                            <i class="fas fa-check-circle"></i> Complete Order & Generate Invoice
                        </button>
                        <button class="btn btn-secondary" onclick="previewInvoice()">
                            <i class="fas fa-eye"></i> Preview Invoice
                        </button>
                        <button class="btn btn-danger" onclick="clearForm()">
                            <i class="fas fa-trash"></i> Clear Form
                        </button>
                    </div>
                </div>
                
                <!-- Orders Tab -->
                <div id="orders" class="tab-content">
                    <div class="card">
                        <h2 class="card-title">
                            <i class="fas fa-history"></i> Order History
                        </h2>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="search-orders">Search Orders</label>
                                <input type="text" id="search-orders" placeholder="Search by company, serial number..." onkeyup="searchOrders()">
                            </div>
                            <div class="form-group">
                                <label for="filter-status">Filter by Status</label>
                                <select id="filter-status" onchange="filterOrders()">
                                    <option value="all">All Orders</option>
                                    <option value="pending">Pending</option>
                                    <option value="packed">Packed</option>
                                    <option value="shipped">Shipped</option>
                                    <option value="delivered">Delivered</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="orders-list" id="orders-list">
                            <!-- orders will be populated by javascript. -->
                        </div>
                    </div>
                </div>
                
                <!-- generator models tab. -->
                <div id="generators" class="tab-content">
                    <div class="card">
                        <h2 class="card-title">
                            <i class="fas fa-plus-circle"></i> Add New Generator Model
                        </h2>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="model-name">Model Name *</label>
                                <input type="text" id="model-name" placeholder="e.g., PowerMax Pro 8000">
                            </div>
                            <div class="form-group">
                                <label for="model-watts">Power (Watts) *</label>
                                <select id="model-watts">
                                    <option value="2000">2000W</option>
                                    <option value="3000">3000W</option>
                                    <option value="5000">5000W</option>
                                    <option value="8000">8000W</option>
                                    <option value="10000">10000W</option>
                                    <option value="12000">12000W</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="model-length">Default Length (cm)</label>
                                <input type="number" id="model-length" value="80">
                            </div>
                            <div class="form-group">
                                <label for="model-width">Default Width (cm)</label>
                                <input type="number" id="model-width" value="60">
                            </div>
                            <div class="form-group">
                                <label for="model-height">Default Height (cm)</label>
                                <input type="number" id="model-height" value="70">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="model-weight">Weight (kg)</label>
                                <input type="number" id="model-weight" value="85">
                            </div>
                            <div class="form-group">
                                <label for="model-price">Base Price ($)</label>
                                <input type="number" id="model-price" value="1299">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="model-description">Description</label>
                            <textarea id="model-description" rows="3" placeholder="Enter model description..."></textarea>
                        </div>
                        
                        <button class="btn btn-success" onclick="addGeneratorModel()">
                            <i class="fas fa-plus"></i> Add Generator Model
                        </button>
                    </div>
                    
                    <div class="card">
                        <h2 class="card-title">
                            <i class="fas fa-list"></i> Available Generator Models
                        </h2>
                        <div id="generator-models-list">
                            <!-- generator models will be populated by javascript. -->
                        </div>
                    </div>
                </div>
                
                <!-- reports tab. -->
                <div id="reports" class="tab-content">
                    <div class="card">
                        <h2 class="card-title">
                            <i class="fas fa-chart-pie"></i> Sales Dashboard
                        </h2>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <i class="fas fa-shopping-cart fa-2x" style="color: var(--primary);"></i>
                                <div class="stat-number" id="total-orders">0</div>
                                <div class="stat-label">Total Orders</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-bolt fa-2x" style="color: var(--success);"></i>
                                <div class="stat-number" id="total-generators">0</div>
                                <div class="stat-label">Generators Sold</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-dollar-sign fa-2x" style="color: var(--warning);"></i>
                                <div class="stat-number" id="total-revenue">$0</div>
                                <div class="stat-label">Total Revenue</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2 class="card-title">
                            <i class="fas fa-chart-bar"></i> Generator Sales by Model
                        </h2>
                        <div id="sales-chart">
                            <canvas id="salesChart" height="300"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2 class="card-title">
                            <i class="fas fa-file-export"></i> Export Data
                        </h2>
                        <div class="form-row">
                            <button class="btn btn-primary" onclick="exportOrdersCSV()">
                                <i class="fas fa-file-csv"></i> Export Orders (CSV)
                            </button>
                            <button class="btn btn-success" onclick="exportInvoicePDF()">
                                <i class="fas fa-file-pdf"></i> Export Latest Invoice (PDF)
                            </button>
                            <button class="btn btn-secondary" onclick="backupDatabase()">
                                <i class="fas fa-database"></i> Backup Database
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-info-circle"></i> Quick Actions
                    </h2>
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="switchTab('new-order')">
                        <i class="fas fa-plus"></i> Create New Order
                    </button>
                    <button class="btn btn-secondary" style="width: 100%; margin-bottom: 10px;" onclick="loadTodaysOrders()">
                        <i class="fas fa-calendar-day"></i> Today's Orders
                    </button>
                    <button class="btn btn-success" style="width: 100%; margin-bottom: 10px;" onclick="printPackingSlip()">
                        <i class="fas fa-print"></i> Print Packing Slip
                    </button>
                </div>
                
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-clock"></i> Recent Orders
                    </h2>
                    <div id="recent-orders">
                        <!-- recent orders will be populated by javascript. -->
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-calculator"></i> Order Summary
                    </h2>
                    <div id="order-summary">
                        <div class="order-detail-item">
                            <span>Selected Generator:</span>
                            <span id="summary-model">None</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Quantity:</span>
                            <span id="summary-quantity">1</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Pallet Size:</span>
                            <span id="summary-pallet">Standard</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Dimensions:</span>
                            <span id="summary-dimensions">-</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Total Weight:</span>
                            <span id="summary-weight">0 kg</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Estimated Cost:</span>
                            <span id="summary-cost" style="font-weight: 600; color: var(--primary);">$0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- invoice modal. -->
    <div class="modal" id="invoice-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Invoice Preview</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="invoice-content">
                <!-- invoice content will be populated by javascript. -->
            </div>
            <div style="margin-top: 25px; display: flex; gap: 15px;">
                <button class="btn btn-primary" onclick="printInvoice()">
                    <i class="fas fa-print"></i> Print Invoice
                </button>
                <button class="btn btn-secondary" onclick="closeModal()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>
    
    <!-- order details modal. -->
    <div class="modal" id="order-detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Order Details</h3>
                <button class="close-btn" onclick="closeOrderModal()">&times;</button>
            </div>
            <div id="order-detail-content">
                <!-- order details will be populated by javascript. -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // initialise database and default data.
        let db;
        let selectedGenerator = null;
        let currentOrderId = null;
        let salesChart = null;

        // default generator models.
        const defaultGenerators = [
            { id: 1, name: "PowerMax Lite 2000", watts: 2000, length: 60, width: 40, height: 50, weight: 45, price: 899, description: "Compact portable generator for light use" },
            { id: 2, name: "EcoGen Pro 3000", watts: 3000, length: 70, width: 45, height: 55, weight: 58, price: 1299, description: "Eco-friendly with low noise output" },
            { id: 3, name: "Industrial Max 5000", watts: 5000, length: 80, width: 50, height: 65, weight: 85, price: 1899, description: "Heavy-duty for construction sites" },
            { id: 4, name: "PowerMaster 8000", watts: 8000, length: 90, width: 60, height: 75, weight: 120, price: 2499, description: "Commercial grade with automatic voltage regulation" },
            { id: 5, name: "MegaPower 10000", watts: 10000, length: 100, width: 65, height: 85, weight: 150, price: 3299, description: "Industrial power solution with dual fuel" },
            { id: 6, name: "Titan 12000", watts: 12000, length: 110, width: 70, height: 95, weight: 180, price: 4299, description: "Maximum power output for large applications" }
        ];

        // pallet size configurations.
        const palletSizes = {
            standard: { name: "Standard Pallet", length: 120, width: 80 },
            euro: { name: "Euro Pallet", length: 120, width: 100 },
            industrial: { name: "Industrial Pallet", length: 120, width: 120 },
            custom: { name: "Custom Pallet" }
        };

        // initialise the database.
        function initDatabase() {
            const request = indexedDB.open('PalleterDB', 2);

            request.onerror = function(event) {
                console.error("Database error:", event.target.error);
            };

            request.onsuccess = function(event) {
                db = event.target.result;
                console.log("Database initialized successfully");
                loadGenerators();
                loadOrders();
                updateDashboard();
            };

            request.onupgradeneeded = function(event) {
                db = event.target.result;
                
                // create object stores.
                const generatorStore = db.createObjectStore('generators', { keyPath: 'id', autoIncrement: true });
                const orderStore = db.createObjectStore('orders', { keyPath: 'id', autoIncrement: true });
                
                // create indexes for faster queries.
                generatorStore.createIndex('name', 'name', { unique: true });
                orderStore.createIndex('company', 'companyName');
                orderStore.createIndex('date', 'orderDate');
                orderStore.createIndex('status', 'status');
                
                // add default generators.
                const transaction = event.target.transaction;
                defaultGenerators.forEach(generator => {
                    transaction.objectStore('generators').add(generator);
                });
            };
        }

        // load generator models from database.
        function loadGenerators() {
            const transaction = db.transaction(['generators'], 'readonly');
            const store = transaction.objectStore('generators');
            const request = store.getAll();

            request.onsuccess = function(event) {
                const generators = event.target.result;
                renderGeneratorCards(generators);
                renderGeneratorModelsList(generators);
            };
        }

        // load orders from database.
        function loadOrders(filter = 'all', search = '') {
            const transaction = db.transaction(['orders'], 'readonly');
            const store = transaction.objectStore('orders');
            const request = store.getAll();

            request.onsuccess = function(event) {
                let orders = event.target.result.sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate));
                
                // apply filters.
                if (filter !== 'all') {
                    orders = orders.filter(order => order.status === filter);
                }
                
                if (search) {
                    const searchLower = search.toLowerCase();
                    orders = orders.filter(order => 
                        order.companyName.toLowerCase().includes(searchLower) ||
                        order.serialNumber.toLowerCase().includes(searchLower) ||
                        order.generatorName.toLowerCase().includes(searchLower)
                    );
                }
                
                renderOrdersList(orders);
                renderRecentOrders(orders.slice(0, 5));
                updateDashboard();
            };
        }

        // render generator cards for selection.
        function renderGeneratorCards(generators) {
            const container = document.getElementById('generator-selector');
            container.innerHTML = '';
            
            generators.forEach(generator => {
                const card = document.createElement('div');
                card.className = 'generator-card';
                card.onclick = () => selectGenerator(generator);
                card.innerHTML = `
                    <div class="generator-badge">${generator.watts}W</div>
                    <div class="generator-name">${generator.name}</div>
                    <div class="generator-watts">${generator.watts.toLocaleString()}W</div>
                    <div class="generator-specs">
                        <div class="spec-item">
                            <span>Dimensions:</span>
                            <span>${generator.length}×${generator.width}×${generator.height} cm</span>
                        </div>
                        <div class="spec-item">
                            <span>Weight:</span>
                            <span>${generator.weight} kg</span>
                        </div>
                        <div class="spec-item">
                            <span>Price:</span>
                            <span>$${generator.price.toLocaleString()}</span>
                        </div>
                    </div>
                    <div style="margin-top: 15px; color: var(--secondary); font-size: 0.9rem;">
                        ${generator.description}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // render generator models list.
        function renderGeneratorModelsList(generators) {
            const container = document.getElementById('generator-models-list');
            container.innerHTML = '';
            
            generators.forEach(generator => {
                const item = document.createElement('div');
                item.className = 'order-item';
                item.innerHTML = `
                    <div class="order-header">
                        <div class="order-company">${generator.name}</div>
                        <span class="badge badge-success">${generator.watts}W</span>
                    </div>
                    <div class="order-details">
                        <div class="order-detail-item">
                            <span>Dimensions:</span>
                            <span>${generator.length}×${generator.width}×${generator.height} cm</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Weight:</span>
                            <span>${generator.weight} kg</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Price:</span>
                            <span>$${generator.price}</span>
                        </div>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn btn-danger btn-sm" onclick="deleteGeneratorModel(${generator.id})" style="padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // select a generator.
        function selectGenerator(generator) {
            selectedGenerator = generator;
            
            // update UI.
            document.querySelectorAll('.generator-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // update dimensions in form.
            document.getElementById('length').value = generator.length;
            document.getElementById('width').value = generator.width;
            document.getElementById('height').value = generator.height;
            
            // update order summary.
            updateOrderSummary();
        }

        // update order summary in sidebar.
        function updateOrderSummary() {
            if (!selectedGenerator) return;
            
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const pallet = document.querySelector('input[name="pallet"]:checked').value;
            const length = document.getElementById('length').value;
            const width = document.getElementById('width').value;
            const height = document.getElementById('height').value;
            
            document.getElementById('summary-model').textContent = selectedGenerator.name;
            document.getElementById('summary-quantity').textContent = quantity;
            document.getElementById('summary-pallet').textContent = palletSizes[pallet].name;
            document.getElementById('summary-dimensions').textContent = `${length}×${width}×${height} cm`;
            document.getElementById('summary-weight').textContent = `${selectedGenerator.weight * quantity} kg`;
            document.getElementById('summary-cost').textContent = `$${(selectedGenerator.price * quantity).toLocaleString()}`;
        }

        // create new order.
        function createOrder() {
            // validate form.
            if (!validateForm()) return;
            
            const companyName = document.getElementById('company-name').value;
            const contactPerson = document.getElementById('contact-person').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const serialNumber = document.getElementById('serial-number').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            const length = parseFloat(document.getElementById('length').value);
            const width = parseFloat(document.getElementById('width').value);
            const height = parseFloat(document.getElementById('height').value);
            const pallet = document.querySelector('input[name="pallet"]:checked').value;
            const notes = document.getElementById('notes').value;
            
            // calculate custom pallet size if selected.
            let palletLength = palletSizes[pallet].length;
            let palletWidth = palletSizes[pallet].width;
            
            if (pallet === 'custom') {
                palletLength = parseFloat(document.getElementById('custom-length').value) || 120;
                palletWidth = parseFloat(document.getElementById('custom-width').value) || 80;
            }
            
            const order = {
                companyName,
                contactPerson,
                email,
                phone,
                address,
                generatorId: selectedGenerator.id,
                generatorName: selectedGenerator.name,
                generatorWatts: selectedGenerator.watts,
                serialNumber,
                quantity,
                length,
                width,
                height,
                weight: selectedGenerator.weight * quantity,
                palletType: pallet,
                palletLength,
                palletWidth,
                totalCost: selectedGenerator.price * quantity,
                notes,
                status: 'pending',
                orderDate: new Date().toISOString(),
                invoiceNumber: generateInvoiceNumber()
            };
            
            // save order to database.
            const transaction = db.transaction(['orders'], 'readwrite');
            const store = transaction.objectStore('orders');
            const request = store.add(order);
            
            request.onsuccess = function(event) {
                currentOrderId = event.target.result;
                showAlert('Order created successfully! Invoice generated.', 'success');
                generateInvoice(order);
                loadOrders();
                clearForm();
                updateDashboard();
            };
            
            request.onerror = function(event) {
                showAlert('Error creating order. Please try again.', 'danger');
            };
        }

        // validate form.
        function validateForm() {
            const requiredFields = [
                'company-name', 'contact-person', 'email', 'phone', 'address',
                'serial-number', 'length', 'width', 'height'
            ];
            
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    showAlert(`Please fill in ${field.previousElementSibling.textContent}`, 'danger');
                    field.focus();
                    return false;
                }
            }
            
            if (!selectedGenerator) {
                showAlert('Please select a generator model', 'danger');
                return false;
            }
            
            // validate email format.
            const email = document.getElementById('email').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showAlert('Please enter a valid email address', 'danger');
                return false;
            }
            
            return true;
        }

        // show alert message.
        function showAlert(message, type) {
            const alertArea = document.getElementById('alert-area');
            alertArea.innerHTML = `
                <div class="alert alert-${type}">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                    ${message}
                </div>
            `;
            
            setTimeout(() => {
                alertArea.innerHTML = '';
            }, 5000);
        }

        // generate invoice number.
        function generateInvoiceNumber() {
            const date = new Date();
            const year = date.getFullYear().toString().slice(-2);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `INV-${year}${month}${day}-${random}`;
        }

        // generate invoice.
        function generateInvoice(order) {
            const invoiceContent = document.getElementById('invoice-content');
            const today = new Date().toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            const palletInfo = palletSizes[order.palletType];
            const palletSizeText = order.palletType === 'custom' 
                ? `${order.palletLength}×${order.palletWidth} cm (Custom)`
                : `${palletInfo.length}×${palletInfo.width} cm`;
            
            invoiceContent.innerHTML = `
                <div class="invoice-preview">
                    <div class="invoice-header">
                        <h2 style="margin-bottom: 10px;">Palleter</h2>
                        <h3 style="color: var(--primary); margin-bottom: 5px;">INVOICE</h3>
                        <div style="color: var(--secondary);">${order.invoiceNumber}</div>
                        <div style="margin-top: 10px;">${today}</div>
                    </div>
                    
                    <div class="invoice-details">
                        <div>
                            <h4>Bill To:</h4>
                            <p><strong>${order.companyName}</strong><br>
                            ${order.contactPerson}<br>
                            ${order.email}<br>
                            ${order.phone}<br>
                            ${order.address}</p>
                        </div>
                        <div>
                            <h4>Ship To:</h4>
                            <p>${order.address}</p>
                            <h4 style="margin-top: 15px;">Order Status:</h4>
                            <span class="badge ${order.status === 'pending' ? 'badge-warning' : 'badge-success'}">
                                ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                            </span>
                        </div>
                    </div>
                    
                    <table class="invoice-items">
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th>Qty</th>
                                <th>Dimensions</th>
                                <th>Unit Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <strong>${order.generatorName}</strong><br>
                                    ${order.generatorWatts}W Generator<br>
                                    Serial: ${order.serialNumber}
                                </td>
                                <td>${order.quantity}</td>
                                <td>${order.length}×${order.width}×${order.height} cm</td>
                                <td>$${order.totalCost / order.quantity}</td>
                                <td>$${order.totalCost.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td colspan="4" style="text-align: right;"><strong>Palletisation (${palletSizeText})</strong></td>
                                <td>Included</td>
                            </tr>
                            <tr>
                                <td colspan="4" style="text-align: right;"><strong>Shipping & Handling</strong></td>
                                <td>Calculated at shipping</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="invoice-total">
                        <div style="margin-bottom: 10px;">Subtotal: $${order.totalCost.toFixed(2)}</div>
                        <div style="margin-bottom: 10px;">Tax (10%): $${(order.totalCost * 0.1).toFixed(2)}</div>
                        <div style="font-size: 1.4rem; color: var(--primary);">
                            <strong>Total: $${(order.totalCost * 1.1).toFixed(2)}</strong>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--gray);">
                        <h4>Packing Instructions:</h4>
                        <p>• Use ${palletSizeText} pallet<br>
                        • Total weight: ${order.weight} kg<br>
                        • Secure with stretch wrap and corner protectors<br>
                        • Attach shipping label and packing slip<br>
                        • Mark as FRAGILE - HEAVY MACHINERY</p>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center; color: var(--secondary); font-size: 0.9rem;">
                        Thank you for choosing Palleter!<br>
                        Professional Generator Palletisation And Shipping Solutions
                    </div>
                </div>
            `;
            
            // show modal.
            document.getElementById('invoice-modal').classList.add('active');
        }

        // render orders list.
        function renderOrdersList(orders) {
            const container = document.getElementById('orders-list');
            container.innerHTML = '';
            
            if (orders.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--secondary);">No orders found</div>';
                return;
            }
            
            orders.forEach(order => {
                const orderDate = new Date(order.orderDate).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                const item = document.createElement('div');
                item.className = 'order-item';
                item.onclick = () => showOrderDetails(order);
                item.innerHTML = `
                    <div class="order-header">
                        <div>
                            <div class="order-company">${order.companyName}</div>
                            <div class="order-date">${orderDate} • ${order.invoiceNumber}</div>
                        </div>
                        <span class="badge ${order.status === 'pending' ? 'badge-warning' : 'badge-success'}">
                            ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                        </span>
                    </div>
                    <div class="order-details">
                        <div class="order-detail-item">
                            <span>Generator:</span>
                            <span>${order.generatorName} (${order.generatorWatts}W)</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Qty:</span>
                            <span>${order.quantity}</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Serial:</span>
                            <span>${order.serialNumber}</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Total:</span>
                            <span>$${order.totalCost.toFixed(2)}</span>
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // render recent orders.
        function renderRecentOrders(orders) {
            const container = document.getElementById('recent-orders');
            container.innerHTML = '';
            
            orders.forEach(order => {
                const orderDate = new Date(order.orderDate).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric'
                });
                
                const item = document.createElement('div');
                item.className = 'order-item';
                item.style.padding = '15px';
                item.style.marginBottom = '10px';
                item.onclick = () => showOrderDetails(order);
                item.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-weight: 600; color: var(--dark); font-size: 0.95rem;">
                            ${order.companyName}
                        </div>
                        <div style="color: var(--secondary); font-size: 0.85rem;">
                            ${orderDate}
                        </div>
                    </div>
                    <div style="margin-top: 8px; color: var(--secondary); font-size: 0.9rem;">
                        ${order.generatorName} • $${order.totalCost.toFixed(2)}
                    </div>
                    <div style="margin-top: 5px;">
                        <span class="badge ${order.status === 'pending' ? 'badge-warning' : 'badge-success'}" 
                              style="font-size: 0.75rem; padding: 2px 8px;">
                            ${order.status}
                        </span>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // show order details.
        function showOrderDetails(order) {
            const container = document.getElementById('order-detail-content');
            const orderDate = new Date(order.orderDate).toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            container.innerHTML = `
                <div class="invoice-preview">
                    <h3 style="margin-bottom: 20px; color: var(--primary);">Order Details</h3>
                    
                    <div class="order-details" style="grid-template-columns: 1fr; gap: 15px;">
                        <div class="order-detail-item">
                            <span>Company:</span>
                            <span>${order.companyName}</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Contact:</span>
                            <span>${order.contactPerson} • ${order.phone}</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Email:</span>
                            <span>${order.email}</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Order Date:</span>
                            <span>${orderDate}</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Invoice Number:</span>
                            <span>${order.invoiceNumber}</span>
                        </div>
                        <div class="order-detail-item">
                            <span>Status:</span>
                            <span class="badge ${order.status === 'pending' ? 'badge-warning' : 'badge-success'}">
                                ${order.status}
                            </span>
                        </div>
                    </div>
                    
                    <div style="margin: 25px 0; padding: 20px; background: var(--light); border-radius: 8px;">
                        <h4 style="margin-bottom: 15px;">Generator Information</h4>
                        <div class="order-details">
                            <div class="order-detail-item">
                                <span>Model:</span>
                                <span>${order.generatorName}</span>
                            </div>
                            <div class="order-detail-item">
                                <span>Power:</span>
                                <span>${order.generatorWatts}W</span>
                            </div>
                            <div class="order-detail-item">
                                <span>Quantity:</span>
                                <span>${order.quantity}</span>
                            </div>
                            <div class="order-detail-item">
                                <span>Serial Number:</span>
                                <span>${order.serialNumber}</span>
                            </div>
                            <div class="order-detail-item">
                                <span>Dimensions:</span>
                                <span>${order.length}×${order.width}×${order.height} cm</span>
                            </div>
                            <div class="order-detail-item">
                                <span>Weight:</span>
                                <span>${order.weight} kg</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin: 25px 0; padding: 20px; background: var(--light); border-radius: 8px;">
                        <h4 style="margin-bottom: 15px;">Pallet & Shipping</h4>
                        <div class="order-details">
                            <div class="order-detail-item">
                                <span>Pallet Type:</span>
                                <span>${order.palletType.charAt(0).toUpperCase() + order.palletType.slice(1)}</span>
                            </div>
                            <div class="order-detail-item">
                                <span>Pallet Size:</span>
                                <span>${order.palletLength}×${order.palletWidth} cm</span>
                            </div>
                            <div class="order-detail-item">
                                <span>Total Cost:</span>
                                <span style="font-weight: 600; color: var(--primary);">$${order.totalCost.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${order.notes ? `
                        <div style="margin: 25px 0;">
                            <h4>Notes:</h4>
                            <p style="padding: 15px; background: var(--light); border-radius: 8px;">${order.notes}</p>
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 30px; display: flex; gap: 15px;">
                        <button class="btn btn-primary" onclick="updateOrderStatus(${order.id}, 'packed')">
                            <i class="fas fa-box"></i> Mark as Packed
                        </button>
                        <button class="btn btn-success" onclick="updateOrderStatus(${order.id}, 'shipped')">
                            <i class="fas fa-shipping-fast"></i> Mark as Shipped
                        </button>
                        <button class="btn btn-secondary" onclick="printOrderInvoice(${order.id})">
                            <i class="fas fa-print"></i> Print Invoice
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('order-detail-modal').classList.add('active');
        }

        // update order status.
        function updateOrderStatus(orderId, status) {
            const transaction = db.transaction(['orders'], 'readwrite');
            const store = transaction.objectStore('orders');
            const request = store.get(orderId);
            
            request.onsuccess = function(event) {
                const order = event.target.result;
                order.status = status;
                
                const updateRequest = store.put(order);
                updateRequest.onsuccess = function() {
                    showAlert(`Order marked as ${status}`, 'success');
                    loadOrders();
                    closeOrderModal();
                };
            };
        }

        // add new generator model.
        function addGeneratorModel() {
            const name = document.getElementById('model-name').value;
            const watts = parseInt(document.getElementById('model-watts').value);
            const length = parseFloat(document.getElementById('model-length').value);
            const width = parseFloat(document.getElementById('model-width').value);
            const height = parseFloat(document.getElementById('model-height').value);
            const weight = parseFloat(document.getElementById('model-weight').value);
            const price = parseFloat(document.getElementById('model-price').value);
            const description = document.getElementById('model-description').value;
            
            if (!name) {
                showAlert('Please enter a model name', 'danger');
                return;
            }
            
            const generator = {
                name,
                watts,
                length,
                width,
                height,
                weight,
                price,
                description
            };
            
            const transaction = db.transaction(['generators'], 'readwrite');
            const store = transaction.objectStore('generators');
            const request = store.add(generator);
            
            request.onsuccess = function() {
                showAlert('Generator model added successfully', 'success');
                loadGenerators();
                
                // clear form.
                document.getElementById('model-name').value = '';
                document.getElementById('model-description').value = '';
            };
        }

        // delete generator model.
        function deleteGeneratorModel(id) {
            if (!confirm('Are you sure you want to delete this generator model?')) return;
            
            const transaction = db.transaction(['generators'], 'readwrite');
            const store = transaction.objectStore('generators');
            store.delete(id);
            
            transaction.oncomplete = function() {
                showAlert('Generator model deleted', 'success');
                loadGenerators();
            };
        }

        // update dashboard statistics.
        function updateDashboard() {
            const transaction = db.transaction(['orders'], 'readonly');
            const store = transaction.objectStore('orders');
            const request = store.getAll();
            
            request.onsuccess = function(event) {
                const orders = event.target.result;
                
                // calculate statistics.
                const totalOrders = orders.length;
                const totalGenerators = orders.reduce((sum, order) => sum + order.quantity, 0);
                const totalRevenue = orders.reduce((sum, order) => sum + order.totalCost, 0);
                
                // update UI.
                document.getElementById('total-orders').textContent = totalOrders;
                document.getElementById('total-generators').textContent = totalGenerators;
                document.getElementById('total-revenue').textContent = `$${totalRevenue.toLocaleString()}`;
                
                // update sales chart.
                updateSalesChart(orders);
            };
        }

        // update sales chart.
        function updateSalesChart(orders) {
            const ctx = document.getElementById('salesChart').getContext('2d');
            
            // group orders by generator model.
            const modelSales = {};
            orders.forEach(order => {
                if (!modelSales[order.generatorName]) {
                    modelSales[order.generatorName] = 0;
                }
                modelSales[order.generatorName] += order.quantity;
            });
            
            const labels = Object.keys(modelSales);
            const data = Object.values(modelSales);
            
            // destroy existing chart if it exists.
            if (salesChart) {
                salesChart.destroy();
            }
            
            // create new chart.
            salesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Number of Generators Sold',
                        data: data,
                        backgroundColor: [
                            'rgba(37, 99, 235, 0.7)',
                            'rgba(16, 185, 129, 0.7)',
                            'rgba(245, 158, 11, 0.7)',
                            'rgba(239, 68, 68, 0.7)',
                            'rgba(139, 92, 246, 0.7)',
                            'rgba(14, 165, 233, 0.7)'
                        ],
                        borderColor: [
                            'rgb(37, 99, 235)',
                            'rgb(16, 185, 129)',
                            'rgb(245, 158, 11)',
                            'rgb(239, 68, 68)',
                            'rgb(139, 92, 246)',
                            'rgb(14, 165, 233)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // switch between tabs.
        function switchTab(tabName) {
            // update tab buttons.
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // update tab content.
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // refresh data if needed.
            if (tabName === 'reports') {
                updateDashboard();
            }
        }

        // search orders.
        function searchOrders() {
            const searchTerm = document.getElementById('search-orders').value;
            const filter = document.getElementById('filter-status').value;
            loadOrders(filter, searchTerm);
        }

        // filter orders.
        function filterOrders() {
            const filter = document.getElementById('filter-status').value;
            const searchTerm = document.getElementById('search-orders').value;
            loadOrders(filter, searchTerm);
        }

        // load today's orders.
        function loadTodaysOrders() {
            const today = new Date().toISOString().split('T')[0];
            const transaction = db.transaction(['orders'], 'readonly');
            const store = transaction.objectStore('orders');
            const request = store.getAll();
            
            request.onsuccess = function(event) {
                const orders = event.target.result.filter(order => 
                    order.orderDate.startsWith(today)
                );
                
                document.getElementById('filter-status').value = 'all';
                document.getElementById('search-orders').value = '';
                renderOrdersList(orders);
                showAlert(`Found ${orders.length} orders today`, 'success');
            };
        }

        // preview invoice.
        function previewInvoice() {
            if (!validateForm()) return;
            
            // create a temporary order object for preview.
            const order = {
                companyName: document.getElementById('company-name').value,
                contactPerson: document.getElementById('contact-person').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                generatorName: selectedGenerator ? selectedGenerator.name : 'Sample Generator',
                generatorWatts: selectedGenerator ? selectedGenerator.watts : 5000,
                serialNumber: document.getElementById('serial-number').value,
                quantity: parseInt(document.getElementById('quantity').value) || 1,
                length: document.getElementById('length').value,
                width: document.getElementById('width').value,
                height: document.getElementById('height').value,
                weight: selectedGenerator ? selectedGenerator.weight : 85,
                palletType: document.querySelector('input[name="pallet"]:checked').value,
                totalCost: selectedGenerator ? selectedGenerator.price : 1299,
                status: 'pending',
                orderDate: new Date().toISOString(),
                invoiceNumber: 'INV-PREVIEW'
            };
            
            generateInvoice(order);
        }

        // print invoice.
        function printInvoice() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Palleter - Invoice</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; }
                        .invoice-header { text-align: center; margin-bottom: 30px; }
                        .invoice-details { display: flex; justify-content: space-between; margin: 30px 0; }
                        table { width: 100%; border-collapse: collapse; margin: 30px 0; }
                        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background-color: #f5f5f5; }
                        .total { text-align: right; font-size: 1.2em; font-weight: bold; margin-top: 20px; }
                    </style>
                </head>
                <body>
                    ${document.getElementById('invoice-content').innerHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // print order invoice.
        function printOrderInvoice(orderId) {
            const transaction = db.transaction(['orders'], 'readonly');
            const store = transaction.objectStore('orders');
            const request = store.get(orderId);
            
            request.onsuccess = function(event) {
                const order = event.target.result;
                generateInvoice(order);
                setTimeout(printInvoice, 500);
            };
        }

        // print packing slip.
        function printPackingSlip() {
            if (!selectedGenerator) {
                showAlert('Please select a generator first', 'danger');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Palleter - Packing Slip</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .details { margin: 30px 0; }
                        .section { margin: 25px 0; }
                        .barcode { text-align: center; margin: 40px 0; font-family: monospace; font-size: 24px; }
                        .instructions { border: 2px solid #000; padding: 20px; margin: 30px 0; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Palleter</h1>
                        <h2>PACKING SLIP</h2>
                        <p>Generator Palletisation System</p>
                    </div>
                    
                    <div class="details">
                        <h3>Generator Details:</h3>
                        <p><strong>Model:</strong> ${selectedGenerator.name}</p>
                        <p><strong>Power:</strong> ${selectedGenerator.watts}W</p>
                        <p><strong>Dimensions:</strong> ${selectedGenerator.length}×${selectedGenerator.width}×${selectedGenerator.height} cm</p>
                        <p><strong>Weight:</strong> ${selectedGenerator.weight} kg</p>
                    </div>
                    
                    <div class="section">
                        <h3>Pallet Requirements:</h3>
                        <p>• Use standard 120×80 cm pallet</p>
                        <p>• Apply 4 corner protectors</p>
                        <p>• Wrap with industrial stretch film (minimum 5 layers)</p>
                        <p>• Attach FRAGILE and HEAVY stickers on all sides</p>
                    </div>
                    
                    <div class="barcode">
                        ║▌║█║▌│║▌║▌█<br>
                        PALLETER-GEN
                    </div>
                    
                    <div class="instructions">
                        <h3>Packing Instructions:</h3>
                        <p>1. Inspect generator for any visible damage</p>
                        <p>2. Place on center of pallet</p>
                        <p>3. Secure with heavy-duty straps (4-point tie down)</p>
                        <p>4. Apply weather-resistant covering if outdoor storage</p>
                        <p>5. Scan barcode and update system status</p>
                    </div>
                    
                    <div style="text-align: center; margin-top: 50px;">
                        <p><strong>Palleter Quality Assurance:</strong></p>
                        <p>✓ Pre-shipment inspection completed</p>
                        <p>✓ Pallet integrity verified</p>
                        <p>✓ Documentation attached</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // export orders to csv.
        function exportOrdersCSV() {
            const transaction = db.transaction(['orders'], 'readonly');
            const store = transaction.objectStore('orders');
            const request = store.getAll();
            
            request.onsuccess = function(event) {
                const orders = event.target.result;
                
                // create csv content.
                let csv = 'Order ID,Invoice Number,Company,Contact,Email,Phone,Generator Model,Power (W),Serial Number,Quantity,Length,Width,Height,Weight,Pallet Type,Total Cost,Status,Order Date\n';
                
                orders.forEach(order => {
                    csv += `${order.id},${order.invoiceNumber},"${order.companyName}","${order.contactPerson}",${order.email},${order.phone},"${order.generatorName}",${order.generatorWatts},${order.serialNumber},${order.quantity},${order.length},${order.width},${order.height},${order.weight},${order.palletType},${order.totalCost},${order.status},${order.orderDate}\n`;
                });
                
                // download csv file.
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `palleter-orders-${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showAlert('Orders exported to CSV successfully', 'success');
            };
        }

        // export invoice to pdf.
        function exportInvoicePDF() {
            showAlert('PDF export requires additional libraries. CSV export is available.', 'warning');
            // note: for full pdf export, need to integrate a pdf library like jspdf.
        }

        // backup database.
        function backupDatabase() {
            const transaction = db.transaction(['orders', 'generators'], 'readonly');
            const ordersStore = transaction.objectStore('orders');
            const generatorsStore = transaction.objectStore('generators');
            
            const ordersRequest = ordersStore.getAll();
            const generatorsRequest = generatorsStore.getAll();
            
            Promise.all([
                new Promise(resolve => ordersRequest.onsuccess = e => resolve(e.target.result)),
                new Promise(resolve => generatorsRequest.onsuccess = e => resolve(e.target.result))
            ]).then(([orders, generators]) => {
                const backup = {
                    timestamp: new Date().toISOString(),
                    orders,
                    generators
                };
                
                const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `palleter-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showAlert('Database backup created successfully', 'success');
            });
        }

        // clear form.
        function clearForm() {
            if (confirm('Are you sure you want to clear the form?')) {
                document.getElementById('company-name').value = '';
                document.getElementById('contact-person').value = '';
                document.getElementById('email').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('address').value = '';
                document.getElementById('serial-number').value = '';
                document.getElementById('quantity').value = '1';
                document.getElementById('length').value = '';
                document.getElementById('width').value = '';
                document.getElementById('height').value = '';
                document.getElementById('notes').value = '';
                
                selectedGenerator = null;
                document.querySelectorAll('.generator-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                updateOrderSummary();
                showAlert('Form cleared', 'success');
            }
        }

        // close modal.
        function closeModal() {
            document.getElementById('invoice-modal').classList.remove('active');
        }

        // close order modal.
        function closeOrderModal() {
            document.getElementById('order-detail-modal').classList.remove('active');
        }

        // event listeners for real-time updates.
        document.addEventListener('DOMContentLoaded', function() {
            initDatabase();
            
            // add event listeners for real-time updates.
            document.getElementById('quantity').addEventListener('input', updateOrderSummary);
            document.getElementById('length').addEventListener('input', updateOrderSummary);
            document.getElementById('width').addEventListener('input', updateOrderSummary);
            document.getElementById('height').addEventListener('input', updateOrderSummary);
            
            // pallet size change handler.
            document.querySelectorAll('input[name="pallet"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const customPalletDiv = document.getElementById('custom-pallet-size');
                    if (this.value === 'custom') {
                        customPalletDiv.style.display = 'block';
                    } else {
                        customPalletDiv.style.display = 'none';
                    }
                    updateOrderSummary();
                });
            });
            
            // custom pallet size change handler.
            document.getElementById('custom-length')?.addEventListener('input', updateOrderSummary);
            document.getElementById('custom-width')?.addEventListener('input', updateOrderSummary);
            
            // auto-save functionality (every 30 seconds).
            setInterval(function() {
                if (document.getElementById('company-name').value) {
                    console.log('Auto-saving form data...');
                    // in a real application, save draft data here.
                }
            }, 30000);
            
            // keyboard shortcuts.
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    switchTab('new-order');
                }
                if (e.ctrlKey && e.key === 'o') {
                    e.preventDefault();
                    switchTab('orders');
                }
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    if (document.getElementById('new-order').classList.contains('active')) {
                        createOrder();
                    }
                }
            });
            
            // show keyboard shortcut help.
            setTimeout(() => {
                console.log('Keyboard shortcuts:');
                console.log('Ctrl+N: New Order');
                console.log('Ctrl+O: View Orders');
                console.log('Ctrl+S: Save Order');
            }, 1000);
        });
    </script>
</body>
</html>